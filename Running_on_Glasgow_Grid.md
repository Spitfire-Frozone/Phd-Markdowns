# This is aimed at informing users how to obtain datasets from eos and run over them using the grid systems available at Glasgow#

## "Running on Glasgow Grid" ##
===============================================================================
Last Edited: 19-06-2018
-------------------------------------------------------------------------------

# Logging in and setup
Glasgow PPE has a system integrated into lxplus. So to log in you need to first log into lxplus.
Taken from: https://twiki.ppe.gla.ac.uk/bin/view/IT/GridServices
~~~
ssh -Y [user]@ppelogin1.ppe.gla.ac.uk
setupATLAS && lsetup rucio
voms-proxy-init -voms atlas
~~~
The tools required for grid job submission and management are available from CVMFS:
~~~
export ATLAS_LOCAL_ROOT_BASE=/cvmfs/atlas.cern.ch/repo/ATLASLocalRootBase
alias setupATLAS='source ${ATLAS_LOCAL_ROOT_BASE}/user/atlasLocalSetup.sh'
setupATLAS

lsetup emi
~~~
If you  are _________________________________ then you should use this command.
~~~
arcproxy -S atlas -N
~~~
However, if you plan to submit jobs to the ScotGrid VO, at present you must also amend the X509_VOMSES environment variable as follows, and you need a proxy.
~~~
export X509_VOMSES=/etc/vomses
arcproxy -S vo.scotgrid.ac.uk -N
~~~


# Getting Samples
If you want to run on the glasgow system, the most efficient way of doing it will be to get the data on the local group disk. From here the advantage is that is is easier and quicker to access than other remote grid sites, and more importantly, eos. This will be more tailored towards my analysis but the methods should remain the same. The first thing to do is to get a list of all the containers from the grid you want access to (a .txt file can be far more efficient in this regard and may be generated by your analysis group)

For example, my list of containers  require an additional suffix for the container to be read correctly, so I will create and use a script newListWithSuffix.py to do just that.
~~~
cd ATLAS/VHbb
scp dspiteri@lxplus.cern.ch:/afs/cern.ch/work/d/dspiteri/VHbb/CxAODFramework_branch_21.2.33/source/FrameworkSub/Out/CxAOD_r31-10/out_sample_list_sample_grid.13TeV_25ns.mcdata_a.HIGG2D4.txt .
scp dspiteri@lxplus.cern.ch:/afs/cern.ch/work/d/dspiteri/VHbb/CxAODFramework_branch_21.2.33/source/FrameworkSub/Out/CxAOD_r31-10/out_sample_list_sample_grid.13TeV_25ns.mcdata_d.HIGG2D4.txt .

scp dspiteri@lxplus.cern.ch:/afs/cern.ch/user/d/dspiteri/Generic/newListWithSuffix.py .
./newListWithSuffix.py out_sample_list_sample_grid.13TeV_25ns.mcdata_a.HIGG2D4.txt _CxAOD.root
./newListWithSuffix.py out_sample_list_sample_grid.13TeV_25ns.mcdata_d.HIGG2D4.txt _CxAOD.root

rucio add-rule $(more out_sample_list_sample_grid.13TeV_25ns.mcdata_a.HIGG2D4_suffixed.txt) 1 UKI-SCOTGRID-GLASGOW_LOCALGROUPDISK
rucio add-rule $(more out_sample_list_sample_grid.13TeV_25ns.mcdata_d.HIGG2D4_suffixed.txt) 1 UKI-SCOTGRID-GLASGOW_LOCALGROUPDISK
~~~


